<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"></link>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://use.fontawesome.com/5fcca142be.js"></script>
<script type="text/javascript"></script>
{% load staticfiles %}
{% load static %}
{% get_media_prefix as media %}
<link rel="stylesheet" href="{% static "styles/" %}main.scss">
<link rel="stylesheet" href="{% static "styles/" %}that.css">
<link rel="stylesheet" href="{% static "styles/" %}article-list-basic.css">

<!-- Script to load 3D object  -->
<script>

  // var object_to_load_obj_path = "{% static "renders/" %}{{renderObj.object_path}}";
  var object_to_load_obj_path ="";
  var object_to_load_colormap_path = "";
  var object_to_load_specmap_path = "";
  var object_to_load_normalmap_path = "";

  object_to_load_obj_path = "{{ media }}renders/{{ renderObj.object_path }}";
  object_to_load_colormap_path = "{{ media }}renders/{{ renderObj.colormap_path }}";
  object_to_load_specmap_path = "{{ media }}renders/{{ renderObj.specmap_path }}";
  object_to_load_normalmap_path = "{{ media }}renders/{{ renderObj.normalmap_path }}";


</script>

<div class="" style="height: 100%; ">
  <div class="col-lg-9 col-md-9 col-sm-6" id="3d_content" style=" height:100%; overflow-y:hidden; overflow-x: hidden; ">

    <div id="blocker"></div>
    <div id="mydiv"></div>
    <div id="contain">
      <div id="icon-bar" class="icon-bar" style="z-index: 30;">
        <div id="annotation-badge" class="numberCircle fa play-btn badge"></div>
        <i class="fa fa-step-backward fa-2x play-btn" onClick=PreviousView()></i>
        <!-- <i id="play-stop"></i> -->
        <i class="fa fa-play-circle fa-2x play-btn" onClick=StopTour()></i>
        <i class="fa fa-pause fa-2x play-btn" onClick=StopTour()></i>
        <i class="fa fa-step-forward fa-2x play-btn" onClick=NextView()></i>

      </div>
      <canvas id="canvas3D">

      </canvas>
    </div>

    <!-- <div id="css3d_div"></div> -->




  </div>
  <div class="col-lg-3 col-md-3 col-sm-6" id="docked_content" style="height:100%; overflow-y: auto">

    <h1>{{tour.title}}</h1>
    {% for section in all_content %}
      {% if section.class_name == 'Paragraph' %}
        <h3>{{section.title}}</h3>
        <p>{{section.description}}</p>
      {% endif %}

      {% if section.class_name == 'Image' %}
      <img src="{% static "renders/" %}{{section.file_name}}"></img>
      {% endif %}
    {% endfor %}
  </div>
</div>
<div class="fa fa-2x scan-qr-code badge scan-qr-code-index col-lg-3 col-md-3 col-sm-6 col-lg-offset-9 col-md-offset-9col-sm-offset-6" ><a href="https://webqr.com/index.html">SCAN QR CODE</a></div>



<script src="{% static "bower_components/jquery/dist/jquery.js" %}" ></script>
<!-- <script src="{% static "bower_components/three.js/build/three.js" %}" ></script> -->
<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.min.js" ></script>
<script src="{% static "bower_components/threejs-trackball-controls/TrackballControls.js" %}" ></script>
<script src="{% static "bower_components/tween.js/src/Tween.js" %}" ></script>
<script src="{% static "bower_components/dat-gui/build/dat.gui.js" %}" ></script>
<script src="{% static "scripts/draco_decoder.js" %}"></script>
<script src="{% static "scripts/STLLoader.js" %}" ></script>
<script src="{% static "scripts/OBJLoader.js" %}" ></script>
<script src="{% static "scripts/DRACOLoader.js" %}" ></script>
<script src="{% static "scripts/CSS3DRenderer.js" %}" ></script>
<script src="{% static "scripts/render-window.js" %}" ></script>

<script>
  var tools = "{% for section in all_content %}{% if section.class_name == 'Image' %}{{section.title}}{% endif %}{% endfor %}";
  console.log(tools);
</script>

<!-- Script to load annotations -->
<script>

  var Annotation_Set = new AnnotationSet();
  var i = 0;
  console.log({{annotations_list|safe}});
  var annotations = JSON.parse({{annotations_list|safe}});
  console.log(annotations);
  console.log(annotations[0].fields.position);

  var badge = document.getElementById("annotation-badge");


  for(var i=0; i< annotations.length; i++){
      var cam_pos = new THREE.Vector3(annotations[i].fields.camera_pos_x,annotations[i].fields.camera_pos_y,annotations[i].fields.camera_pos_z);
      var target_pos = new THREE.Vector3(annotations[i].fields.target_pos_x,annotations[i].fields.target_pos_y,annotations[i].fields.target_pos_z);
      var Annot_obj = new AnnotationObj(target_pos, cam_pos);
      Annot_obj.text = annotations[i].fields.annotation_text;
      CreateToolTip(Annot_obj.text, i);
      // PopulateDiv("annotation", Annot_obj.text);
      console.log(Annot_obj);
      console.log("annotations.length = ",annotations.length)
      Annotation_Set.AddAnnotation(Annot_obj);
      console.log(Annotation_Set);
  }

  function PlayTour(){
    //TODO: Make the function work
    // togglePlayBtn();
    Annotation_Set.StartAnnotationTour(); };
    badge.innerHTML = Annotation_Set.queue.curr_annot_index+1;
  function StopTour(){
    Annotation_Set.StopAnnotationTour();
    badge.innerHTML = Annotation_Set.queue.curr_annot_index+1;
   };
  function NextView(){
    Annotation_Set.NextAnnotation();
    badge.innerHTML = Annotation_Set.queue.curr_annot_index+1;
  };
  function PreviousView(){
    Annotation_Set.PreviousAnnotation();
    badge.innerHTML = Annotation_Set.queue.curr_annot_index+1;
   };

  var playBtn = document.createElement('i');
  playBtn.setAttribute("class","fa fa-play-circle fa-2x play-btn");
  playBtn.onclick = PlayTour;


  var stopBtn = document.createElement('i');
  stopBtn.setAttribute("class","fa fa-play-pause fa-2x play-btn");
  stopBtn.onclick = StopTour;
  var playingTour = false;
  // document.getElementById("icon-bar").appendChild(playBtn);

  function togglePlayBtn() {

    if(playingTour) {
      stopBtn.parentNode.removeChild(stopBtn);
      playBtn.parentNode.appendChild(playBtn);
      playingTour = false;
    }
    else {
      console.log("lalalla")
      playBtn.parentNode.appendChild(stopBtn);
      playBtn.parentNode.removeChild(playBtn);
      playingTour =true;
    }

  }
</script>
